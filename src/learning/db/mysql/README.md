# mysql

## 当前读与快照读

### 快照读

读取的是记录数据的可见版本（可能是过期的数据），不用加锁

### 当前读

读取的是记录数据的最新版本，并且当前读返回的记录都会加上锁，保证其他事务不会再并发的修改这条记录

---

### select (snapshot read)

当执行 select 的时候，innodb 默认会执行快照读，相当于就是给你目前的状态找了一张照片，以后执行 select 的时候就会返回当前照片里面的数据，当其他事务提交了也对你不造成影响，和你没关系，这就实现了可重复读了

### update, insert, delete (current read)

当你执行这几个操作的时候默认会执行当前读，也就是会读取最新的记录，也就是别的事务提交的数据你也可以看到，这样很好理解啊，假设你要 update 一个记录，另一个事务已经 delete 这条数据并且 commit 了，这样不是会产生冲突吗，所以你 update 的时候肯定要知道最新的信息啊。  
我在这里介绍一下 update 的过程吧，首先会执行当前读，然后把返回的数据加锁，之后执行 update。加锁是防止别的事务在这个时候对这条记录做什么，默认加的是排他锁，也就是你读都不可以，这样就可以保证数据不会出错了。但注意一点，就算你这里加了写锁，别的事务也还是能访问的，是不是很奇怪？数据库采取了一致性非锁定读，别的事务会去读取一个快照数据。  
innodb 默认隔离级别是 RR， 是通过 MVVC 来实现了，读方式有两种，执行 select 的时候是快照读，其余是当前读，所以，mvvc 不能根本上解决幻读的情况

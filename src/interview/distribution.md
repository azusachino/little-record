# DISTRIBUTION QUESTIONS

> 分布式事务的控制

分布式事务是指一个事务会涉及到到多个应用接口调用, 底层数据表涉及到多个, 但数据库可以是一个或多个, 它是传统单数据库事务在广度上的延伸.

事务并发控制, 在OLTP关系型数据库中, 事务并发控制往往是指事务的隔离性, 在本文中, 指的是应用层的并发事务控制, 常用的实现是乐观锁控制.

需要说明的是, 乐观锁解决的是事务并发控制, 它并不能解决分布式事务控制.

1. 接口内部实现本地事务, 接口之间不支持分布式事务, 然后辅以定期对账机制进行修正.
2. 目前的XA实现, 代码无侵入, 但对于并发和性能影响较大.
3. TCC实现, 代码有侵入, 改造难度较大, 但性能较好, 时效性很好
4. 基于消息, 引入了消息中间件, 方案较复杂.

> 分布式锁如何设计

一、zookeeper

1、实现原理：

基于zookeeper瞬时有序节点实现的分布式锁。大致思想即为：每个客户端对某个功能加锁时，在zookeeper上的与该功能对应的指定节点的目录下，生成一个唯一的瞬时有序节点。判断是否获取锁的方式很简单，只需要判断有序节点中序号最小的一个。当释放锁的时候，只需将这个瞬时节点删除即可。同时，其可以避免服务宕机导致的锁无法释放，而产生的死锁问题。

2、优点: 锁安全性高，zk可持久化

3、缺点: 性能开销比较高。因为其需要动态产生、销毁瞬时节点来实现锁功能。

4、实现: 可以直接采用zookeeper第三方库curator即可方便地实现分布式锁。

二、memcached

1、实现原理：

memcached带有add函数，利用add函数的特性即可实现分布式锁。add和set的区别在于：如果多线程并发set，则每个set都会成功，但最后存储的值以最后的set的线程为准。而add的话则相反，add会添加第一个到达的值，并返回true，后续的添加则都会返回false。利用该点即可很轻松地实现分布式锁。

2、优点: 并发高效。

3、缺点

（1）memcached采用列入LRU置换策略，所以如果内存不够，可能导致缓存中的锁信息丢失。
（2）memcached无法持久化，一旦重启，将导致信息丢失。

三、redis

redis分布式锁即可以结合zk分布式锁锁高度安全和memcached并发场景下效率很好的优点，可以利用jedis客户端实现。(setnx, setex)

> 分布式session如何设计

1. 基于数据库的Session共享
2. 基于NFS共享文件系统
3. 基于memcached 的session，如何保证 memcached 本身的高可用性？
4. 基于Redis 的 session 共享
5. 基于cookie 进行session共享

> dubbo的组件有哪些, 各有什么作用

Registry、Monitor、Provider、Consumer

> zookeeper的负载均衡算法有哪些

负载均衡算法

一般来说负载均衡设备都会默认支持多种负载均衡分发策略，例如：

- 轮询（RoundRobin）将请求顺序循环地发到每个服务器。当其中某个服务器发生故障，AX就把其从顺序循环队列中拿出，不参加下一次的轮询，直到其恢复正常。
- 比率（Ratio）：给每个服务器分配一个加权值为比例，根椐这个比例，把用户的请求分配到每个服务器。当其中某个服务器发生故障，AX就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
- 优先权（Priority）：给所有服务器分组，给每个组定义优先权，将用户的请求分配给优先级最高的服务器组（在同一组内，采用预先设定的轮询或比率算法，分配用户的请求）；当最高优先级中所有服务器或者指定数量的服务器出现故障，AX将把请求送给次优先级的服务器组。这种方式，实际为用户提供一种热备份的方式。
- 最少连接数（LeastConnection）：AX会记录当前每台服务器或者服务端口上的连接数，新的连接将传递给连接数最少的服务器。当其中某个服务器发生故障，AX就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
- 最快响应时间（Fast Response time）：新的连接传递给那些响应最快的服务器。当其中某个服务器发生故障，AX就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。

以上为通用的负载均衡算法，还有一些算法根据不同的需求也可能会用到，例如：

- 哈希算法( hash):  将客户端的源地址，端口进行哈希运算，根据运算的结果转发给一台服务器进行处理，当其中某个服务器发生故障，就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
- 基于策略的负载均衡：针对不同的数据流设置导向规则，用户可自行编辑流量分配策略，利用这些策略对通过的数据流实施导向控制。
- 基于数据包的内容分发：例如判断HTTP的URL，如果URL中带有.jpg的扩展名，就把数据包转发到指定的服务器。

> dubbo是如何利用接口就可以通信的

todo

## Java面试题总览

> 用Java实现一个LRU

TODO
> 分布式集群下如何做到唯一序列号

雪花算法(分片, 唯一id(机房号, 主机序列号之类))
> 设计一个秒杀系统, 30分钟没付款就自动关闭交易

todo
> 如何使用redis和zookeeper实现分布式锁? 有什么区别优缺点, 会有什么问题, 分别适用什么场景.(RedLock, 算法实现, 有什么争议)

todo
> 如果有人恶意创建非法连接, 怎么解决?

todo
> 分布式事务的原理, 优缺点, 如何使用分布式事务, 2pc 3pc的区别, 解决了什么问题, 还有什么问题没有解决, 如何解决,, 你自己项目里涉及到分布式事务是怎么处理的?

todo
> 什么是一致性hash

todo
> 什么是restful, 讲讲你理解的restful

todo
> 如何设计一个良好的API

todo
> 如何设计建立和保持100w的长连接

todo
> 解释什么是MESI协议(缓存一致性)

todo
> 讲讲你知道的几种hash算法

todo
> 什么是paxos算法, 什么是zab协议

todo
> 一个在线文档系统, 文档可以被编辑, 如何防止多人同时对同一份文档进行编辑更新

todo
> 线上系统突然变得异常缓慢, 你如何查找问题

todo
> 说说你平时用到的设计模式

todo
> Dubbo的原理, 有看过源码吗, 数据是怎么流转的, 怎么实现集群, 负载均衡, 服务注册和发现, 重试转发, 快速失败的策略是怎样的?

todo
> 一次RPC请求的流程是什么?

todo
> 自己实现过RPC吗, 原理可以简单讲讲? RPC要解决什么问题?

todo
> 异步模式的用途和意义

非阻塞
> 编程中自己是怎么思考一些设计原则的, 比如开闭原则, 以及在工作中的应用

todo
> 设计一个社交网站中的"私信"功能, 要求高并发, 可扩展等等, 画一下架构图

todo
> MVC模式, 常见的MVC框架

todo
> 聊一下曾经参与设计的服务器架构并画图, 谈谈遇到的问题, 怎么解决的?

todo
> 应用服务怎么监控性能, 各种方式的区别?

todo
> 如何设计一套高并发支付方案, 架构如何设计

todo
> 如何实现负载均衡, 有哪些算法可以实现?

todo
> Zookeeper的用途, 选举的机制是什么?

todo
> Zookeeper watch机制原理

todo
> Mybatis的底层实现原理

todo
> 请思考一个方案, 实现分布式环境下的countdownlatch

todo
> 后台系统怎么防止请求重复提交

todo
> 描述一个服务从发布到被消费的详细过程

todo
> 讲讲你理解的服务治理?

todo
> 如何做到接口的幂等性

todo
> 如何做限流策略, 令牌桶和漏斗算法的使用场景

todo
> 什么叫数据一致性, 你怎么理解数据一致性

todo
> 分布式服务调用方, 不依赖服务提供方的话, 怎么处理服务方挂掉后, 大量无效资源请求的浪费, 如果只是服务提供方吞吐不高的时候该怎么做? 如果服务挂了, 那么一会重启, 该怎么做到最小的资源浪费, 流量半开的机制是什么?

todo
> dubbo的泛化掉哟个是怎么实现的, 如果是你, 你会怎么做?

todo
> 远程调用时会出现超市现象, 如何做到优雅的控制, JDK自带的超时机制有哪些? 怎么实现的?

todo
